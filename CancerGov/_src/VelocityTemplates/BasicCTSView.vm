<script src="/PublishedContent/js/BasicCTSViewPage.js" type="text/javascript"></script>

## Draws a Single Location Item

#macro(DrawLocation $loc)
<div itemprop="location" itemscope="" itemtype="http://schema.org/Place">
  <strong itemprop="name">$loc.FacilityName</strong>
  <br>
    <span itemprop="address" itemscope="" itemtype="http://schema.org/PostalAddress">
      <meta itemprop="addressCountry" content="$loc.PostalAddress.CountryName" />
      <span itemprop="addressLocality">$loc.PostalAddress.City</span>##
#if (!$Tools.IsNullOrWhitespace($loc.PostalAddress.PoliticalSubUnitName))##
, <span itemprop="addressRegion">$loc.PostalAddress.PoliticalSubUnitName</span>
      #end
    </span>
    <br>

      #if ($loc.HasContact)
      Contact:
      #if (!$Tools.IsNullOrWhitespace($loc.CTGovContact.SurName))
      $loc.CTGovContact.SurName
      #else
      Name Not Available
      #end
      <br>
        #if (!$Tools.IsNullOrWhitespace($loc.CTGovContact.Phone))
        Phone: $loc.CTGovContact.Phone
        #end

        #if (!$Tools.IsNullOrWhitespace($loc.CTGovContact.Email))
        Email: <a href="mailto:$loc.CTGovContact.Email">$loc.CTGovContact.Email</a>
        #end
        #end
        <br>
          <br>
	</div>
#end

#macro(DrawLocations)
#if($SearchResults.Control.GetShowAll() > 0)
#DrawFilterableLocations()
#elseif($SearchResults.Control.HasZip())
#DrawProximityLocations()
#else
#DrawFilterableLocations()
#end
#end

#macro(DrawNoLocations)
#if($SearchResults.Trial.CurrentProtocolStatus == "Not yet active")
Location information is not yet available.
#else
See trial information on <a href="https://www.clinicaltrials.gov/show/$SearchResults.Trial.NCTID">ClinicalTrials.gov</a> for a list of participating sites.
#end
#end

## This is used to draw all study sites with filters.
#macro(DrawFilterableLocations)
<div id="filterable-trialslist">
  #if ($SearchResults.Trial.GetAllSortedLocations().USA.Count == 0 && $SearchResults.Trial.GetAllSortedLocations().Canada.Count == 0 && $SearchResults.Trial.GetAllSortedLocations().Other.Count == 0)
  #DrawNoLocations()##
  #else
  <div>
  	#if($SearchResults.Control.GetShowAll() > 0)
		<span class="right location-link">
			<a href="$SearchResults.Control.PageInstruction.GetUrl("ShowNearbyUrl")#trial-location">Show locations near me</a>
		</span>
		#end

		#if ($SearchResults.Trial.GetAllSortedLocations().USA.Count > 0)
		<div data-basiccts-countrygroup="U.S.A.">
			#foreach($state in $SearchResults.Trial.GetAllSortedLocations().USA)
			#each
			<div data-basiccts-psunitgroup="$state.key">
				<h3>$state.key</h3>
				#foreach($loc in $state.Value)
				#each
				#DrawLocation($loc)
				#end
			</div>
			#end
		</div>
		#end
		#if ($SearchResults.Trial.GetAllSortedLocations().Canada.Count > 0)
		<div data-basiccts-countrygroup="Canada">
			#foreach($state in $SearchResults.Trial.GetAllSortedLocations().Canada)
			#each
			<div data-basiccts-psunitgroup="$state.key">
				<h3>$state.key</h3>
				#foreach($loc in $state.Value)
				#each
				#DrawLocation($loc)
				#end
			</div>
			#end
		</div>
		#end
		#if ($SearchResults.Trial.GetAllSortedLocations().Other.Count > 0)
		<div data-basiccts-countrygroup="Other">
			#foreach($country in $SearchResults.Trial.GetAllSortedLocations().Other)
			#each
			<div data-basiccts-psunitgroup="$country.key">
				<h3>$country.key</h3>
				#foreach($loc in $country.value)
				#each
				#DrawLocation($loc)
				#end
			</div>
			#end
		</div>
  </div>
  #end
  #end
</div>
#end

## This is used to draw the closest sites when viewing by proximity
#macro(DrawProximityLocations)
<div id="proximity-trialslist">
  #if($SearchResults.Trial.GetLocationsNearZip($SearchResults.Control.SearchParams.ZipLookup.GeoCode,$SearchResults.Control.SearchParams.ZipRadius).Length == 0)
  #DrawNoLocations()##
  #else

  <span class="location-text">Locations within $SearchResults.Control.SearchParams.ZipRadius miles of ZIP code "$SearchResults.Control.SearchParams.ZipLookup.PostalCode_ZIP"</span>
  <span class="right location-link">
    <a href="$SearchResults.Control.PageInstruction.GetUrl("ShowAllUrl")#trial-location">Show all locations</a>
  </span>
    #foreach($loc in $SearchResults.Trial.GetLocationsNearZip($SearchResults.Control.SearchParams.ZipLookup.GeoCode,$SearchResults.Control.SearchParams.ZipRadius))
    #each
      #DrawLocation($loc)
    #end
    #end
</div>
#end

#macro(DrawMatchingParams $SearchResults)
  #set($plist = $Tools.CreateEmptyStringList())
  #if(!$Tools.IsNullOrWhitespace($SearchResults.Control.GetCancerType()))
	  $plist.Add("type")
  #end
  #if(!$Tools.IsNullOrWhitespace($SearchResults.Control.GetPhrase()))
    $plist.Add("phrase")
  #end
  #if($SearchResults.Control.HasZip())
    $plist.Add("zip")
  #end
  #if($SearchResults.Control.SearchParams.Age > 0)
    $plist.Add("age")
  #end
  #if(($SearchResults.Control.Gender == "Female") || ($SearchResults.Control.Gender == "Male"))
    $plist.Add("gender")
  #end
  #if($SearchResults.Control.GetSearchForAllTrials == true)
    $plist.Add("all trials")
  #end
  
#foreach($param in $plist)##
#each
#if($param == "type")##
"<span data-basiccts-searchparam='t'>$SearchResults.Control.GetCancerType()</span>"##
#elseif($param == "phrase")##
"<span data-basiccts-searchparam='q'>$Tools.Replace($SearchResults.Control.GetPhrase(), '"', '')</span>"##
#elseif($param == "zip")##
near ZIP code "<span data-basiccts-searchparam='z'>$SearchResults.Control.SearchParams.ZipLookup.PostalCode_ZIP</span>"##
#elseif($param == "age")##
taking patients age <span data-basiccts-searchparam='a'>$SearchResults.Control.SearchParams.Age</span>##
#elseif($param == "gender")##
Gender: "<span data-basiccts-searchparam='g'>$SearchResults.Control.SearchParams.Gender</span>"##
#elseif($param == "all trials")##
"all trials"##
#else##
## do nothing
#end##
#between
; ##
#end##
#end##	

<p>
#set($resultsUrl = $SearchResults.Control.PageInstruction.GetUrl("ResultsUrl"))##
<a href="$resultsUrl">&lt; Back to search results</a><br>
This clinical trial matches: #DrawMatchingParams($SearchResults).
</p>

<div class="medium-9 columns">
  #if ($SearchResults.Trial.CurrentProtocolStatus == "Active")
    #set($statusClass = " active")
  #elseif($SearchResults.Trial.CurrentProtocolStatus == "Enrolling by invitation")
    #set($statusClass = " invite")
  #elseif($SearchResults.Trial.CurrentProtocolStatus == "Temporarily closed")
    #set($statusClass = " closed")
  #elseif($SearchResults.Trial.CurrentProtocolStatus == "Not yet active")
    #set($statusClass = " not-active")
  #else
    #set($statusClass = "")
  #end
  <div class="status $statusClass">
    Status: $SearchResults.Trial.CurrentProtocolStatus
  </div>
  <div class="accordion desktop">
    #if (!$Tools.IsNullOrWhitespace($SearchResults.Trial.BriefSummary))
      <section id="trial-description">
        <h2>Description</h2>
        <div>
          $SearchResults.Trial.BriefSummary
        </div>
      </section>
    #end

    #if (!$Tools.IsNullOrWhitespace($SearchResults.Trial.CTEntryCriteria))
      <section id="trial-criteria">
        <h2>Eligibility Criteria</h2>
        <div>
          $SearchResults.Trial.CTEntryCriteria
        </div>
      </section>
    #end


    <section id="trial-location">
      <h2>Locations & Contacts</h2>
      #DrawLocations()
    </section>

    #if (!$Tools.IsNullOrWhitespace($SearchResults.Trial.DetailedDescription))
    <section id="trial-outline">
      <h2>Trial Objectives and Outline</h2>
      <div>
        $SearchResults.Trial.DetailedDescription
      </div>
    </section>
    #end

    <section id="trial-phase">
      <h2>Trial Phase & Type</h2>
      <div>
        <div class="row">
          <div class="medium-6 columns">
            <strong>Trial Phase</strong>
            <p>$SearchResults.GlossifiedPhase</p>
          </div>
          <div class="medium-6 columns">
            <strong>Trial Type</strong>
            <p>$SearchResults.Trial.JoinedTrialTypes</p>
          </div>
        </div>
      </div>
    </section>

    <section id="trial-organization">
      <h2>Lead Organization</h2>
      <div>
        <strong>Lead Sponsor</strong>
        <br>
          $SearchResults.Trial.LeadSponsor<br>
            <br>
              #if($SearchResults.Trial.Collaborators.Count > 0)
              #if($SearchResults.Trial.Collaborators.Count > 1)
              Collaborators<br>
                #else
                Collaborator<br>
                  #end
                  #foreach($collab in $SearchResults.Trial.Collaborators)
                  #each
                  $collab<br>
                    #end
                    #end
                    <br>
                      #if($SearchResults.Trial.OverallOfficials.Count > 0)
                      #if($SearchResults.Trial.OverallOfficials.Count > 1)
                      Principal Investigators<br>
                        #else
                        Principal Investigator<br>
                          #end
                          #foreach($official in $SearchResults.Trial.OverallOfficials)
                          #each
                          $official.SurName<br>
         #end
        #end
			</div>
    </section>

    <section id="trial-ids">
      <h2>Trial IDs</h2>
      <div>
        <strong>Primary ID</strong> $SearchResults.Trial.OrgStudyID <br>
          <strong>Secondary IDs</strong> $SearchResults.Trial.SecondaryIDList <br>
            <strong>Clinicaltrials.gov ID</strong> <a href="http://clinicaltrials.gov/show/$SearchResults.Trial.NCTID">$SearchResults.Trial.NCTID</a> <br>

			</div>
    </section>
  </div>
</div>

<div class="delighter-rail medium-3 columns">
	<!--(bake LiveHelpDelighter.inc)-->
	<!--(bake NextStepDelighter.inc)-->
	<div class="no-resize cts-share">
		<div class="share-text">Share this clinical trial with your doctor:</div>
		<a class="print" title="Print" href="#">
			<span class="icon icon-print"></span>
			<span class="text">Print</span>
		</a>
		#set($emailUrl = $SearchResults.Control.PageInstruction.GetUrl("email"))##
		<a class="email" title="Email" href="$emailUrl">
			<span class="icon icon-email"></span>
			<span class="text">Email</span>
		</a>
    </div>
</div>
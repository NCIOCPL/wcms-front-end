<script src="/PublishedContent/js/BasicCTSResultsPage.js" type="text/javascript"></script>

#macro(DrawLocationInformation $trial)##
<strong>Location: </strong>##
#if ($trial.GetUSLocations().length == 1)##
#set($loc = $trial.GetUSLocations().get(0))##
$loc.FacilityName, $loc.PostalAddress.City, $loc.PostalAddress.PoliticalSubUnitName##
#elseif ($trial.GetUSLocations().length == 0)##
#if($resultItem.CurrentProtocolStatus == "Not yet active")##
Location information is not yet available.##
#else##
See <a href="https://www.clinicaltrials.gov/show/$trial.NCTID" target="_blank">Clinical Trials.gov</a>##
#end##
#else##
$trial.GetUSLocations().length locations##
#if ($SearchResults.Control.HasZip())##
, including $trial.GetUSLocations($SearchResults.Control.SearchParams.ZipLookup.GeoCode, $SearchResults.Control.SearchParams.ZipRadius).length near you##
#end##
#end##
#end##

#macro(DrawNoResultsText)
  <div>
    No results were found matching your criteria.
	<ul>
		<li>Please check if your spelling is correct.</li>
		<li>Please check if your zip code and age are valid.</li>
	<ul>
    <p>For assistance, please contact our Cancer Information Service. You can <a href="/contact" class="live-help-link">chat online</a> or call 1-800-4-CANCER (1-800-622-6237).</p>
    <p><a href="/about-cancer/treatment/clinical-trials/search">Try a new search</a></p>
  </div>
#end

#macro(DrawResults $SearchResults)
  <div class="cts-results-container">
    #foreach($resultItem in $SearchResults.Results.Results)
      #each
        ## Attach Onclick for Analytics elsewhere
        <a href="$SearchResults.Control.GetDetailedViewUrl($resultItem.NCTID)" class="protocol-abstract-link">$resultItem.BriefTitle</a>
        <div class="cts-result-item">
          <strong>Status: </strong>$resultItem.CurrentProtocolStatus<br>
          <strong>Age: </strong>$resultItem.Eligibility.AgeText<br>
          <strong>Gender: </strong>$resultItem.Eligibility.Gender<br>
		  #DrawLocationInformation($resultItem)
		</div>
      #before
        <div class="row collapse">
        <div class="medium-12 columns clinical-trial-individual-result">
      #after
        </div>
        </div>
      #nodata
		#DrawNoResultsText()
    #end
    </div>

    ## If there are results then...
    <div class="ct-results-lower-control basic">
      <div class="pagination">
        ## Get Curr Page

        ## Shows 3 before and 3 after
        #foreach($pagerItem in $SearchResults.Control.GetPagerItems(3,3,$SearchResults.Results.TotalResults))
          #each
            #if($pagerItem.Text == $SearchResults.Control.SearchParams.Page.ToString())
              <span>$pagerItem.Text</span>
            #else
              <a href="$pagerItem.PageUrl">$pagerItem.Text</a>
            #end
          #after
            &nbsp;
        #end
      </div>
    </div>
  </div>
#end

#macro(DrawSearchParams $SearchResults)
  #set($plist = $Tools.CreateEmptyStringList())
  #if(!$Tools.IsNullOrWhitespace($SearchResults.Control.GetCancerType()))
	$plist.Add("type")
  #end
  #if(!$Tools.IsNullOrWhitespace($SearchResults.Control.GetPhrase()))
    $plist.Add("phrase")
  #end
  #if($SearchResults.Control.HasZip())
    $plist.Add("zip")
  #end
  #if($SearchResults.Control.SearchParams.Age > 0)
    $plist.Add("age")
  #end
  #if(($SearchResults.Control.Gender == "Female") || ($SearchResults.Control.Gender == "Male"))
    $plist.Add("gender")
  #end
  #if($SearchResults.Control.GetSearchForAllTrials == true)
    $plist.Add("all trials")
  #end
  
#foreach($param in $plist)##
#each
#if($param == "type")##
Type/Condition: "<span data-basiccts-searchparam='t'>$SearchResults.Control.GetCancerType()</span>"##
#elseif($param == "phrase")##
Keyword: "<span data-basiccts-searchparam='q'>$Tools.Replace($SearchResults.Control.GetPhrase, '"', '')</span>"##
#elseif($param == "zip")##
ZIP: "<span data-basiccts-searchparam='z'>$SearchResults.Control.SearchParams.ZipLookup.PostalCode_ZIP</span>"##
#elseif($param == "age")##
Age: "<span data-basiccts-searchparam='a'>$SearchResults.Control.SearchParams.Age</span>"##
#elseif($param == "gender")##
Gender: "<span data-basiccts-searchparam='g'>$SearchResults.Control.SearchParams.Gender</span>"##
#elseif($param == "all trials")##
"all trials"##
#else##
## do nothing
#end##
#between
, ##
#end##
#end##	

<div class="medium-9 columns">
  #if($SearchResults.Results.TotalResults > 0)
    #if($SearchResults.Control.HasInvalidParams() == false)
	  #if($SearchResults.Control.OutOfBounds($SearchResults.Results.TotalResults) == false)
	    <h5 class="cts-results-title">
		  Results $SearchResults.Control.GetStartItemNum()-$SearchResults.Control.GetEndItemNum($SearchResults.Results.TotalResults) of <span data-basiccts-searchparam='n'>$SearchResults.Results.TotalResults</span> for: #DrawSearchParams($SearchResults)
	    </h5>
	  #else
	    ## Draw no title here
	  #end
      #DrawResults($SearchResults)
    #else
	  #DrawNoResultsText()
    #end
  ## If there are no results, then we need to show a different message
  #else
    <div>
		No clinical trials matched your search for #DrawSearchParams($SearchResults).
		<p>For assistance, please contact our Cancer Information Service. You can <a href="/contact" class="live-help-link">chat online</a> or call 1-800-4-CANCER (1-800-622-6237).</p>
		<p><a href="/about-cancer/treatment/clinical-trials/search">Try a new search</a><p>
	</div>
  #end
</div>
  
## Begin "Delighter" section ##
<div class="delighter-rail medium-3 columns">
	<!--(bake LiveHelpDelighter.inc)-->
	<!--(bake NextStepDelighter.inc)-->
</div>

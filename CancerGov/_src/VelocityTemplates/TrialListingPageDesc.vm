<script src="/PublishedContent/js/BasicCTSResultsPage.js" type="text/javascript"></script>

#macro(DrawLocationInformationV2 $trial)##
#set ($allLocations = $SearchResults.TrialTools.GetAllSortedLocations($trial)) 
<strong>Location: </strong>##

#if ($SearchResults.TrialTools.GetLocCount($allLocations.USA) == 1)##
#foreach($state in $allLocations.USA)
#each
#foreach($loc in $state.Value)
#each
$loc.Name, $loc.City, $loc.StateOrProvince##
#end
#end
#elseif ($SearchResults.TrialTools.GetLocCount($allLocations.USA) == 0)##
#if($resultItem.CurrentTrialStatus.toLower == "not yet active" || $resultItem.CurrentTrialStatus.toLower == "in review" || $resultItem.CurrentTrialStatus.toLower == "approved")##
Location information is not yet available.##
#else##
See <a href="https://www.clinicaltrials.gov/show/$trial.NCTID" target="_blank">Clinical Trials.gov</a>##
#end##
#else##
$SearchResults.TrialTools.GetLocCount($allLocations.USA) locations##
#end##
#end##

#macro(DrawNoResultsTextV2)
  ## Get the "no trials" HTML from the content item
  <div id="listing-no-trials">
  $SearchResults.Control.GetNoTrialsHTML()##
  </div>
#end

#macro(DrawResultsV2 $SearchResults)
  <div class="listing-page-body cts-results-container">
    #foreach($resultItem in $SearchResults.Results.Trials)
      #each
        ## Attach Onclick for Analytics elsewhere
        <a href="$SearchResults.Control.GetDetailedViewUrl($resultItem.NCIID)" class="protocol-abstract-link">$resultItem.BriefTitle</a>
        <div class="cts-result-item">
          $SearchResults.TrialTools.GetBriefSummary($resultItem)<br>
          #DrawLocationInformationV2($resultItem)
        </div>
      #before
        <div class="row collapse">
          <div class="medium-12 columns clinical-trial-individual-result">
      #after
          </div>
        </div>
      #nodata
        #DrawNoResultsTextV2()
    #end
  </div>

  ## If there are results then...
  <div class="ct-results-lower-control basic">
    <div class="pagination">
      ## Get Curr Page

      ## Shows 3 before and 3 after
      #foreach($pagerItem in $SearchResults.Control.GetPagerItems(3,3,$SearchResults.Results.TotalResults))
        #each
          #if($pagerItem.Text == $SearchResults.Control.SearchParams.Page.ToString())
            <span>$pagerItem.Text</span>
          #else
            <a href="$pagerItem.PageUrl">$pagerItem.Text</a>
          #end
        #after
          &nbsp;
      #end
    </div>
  </div>
#end

<div class="row">
  <div class="medium-12 columns collapse">
    #if($SearchResults.Results.TotalResults > 0)
      #if($SearchResults.Control.HasInvalidParams() == false)
        <div class="cts-results-title">
          Trials $SearchResults.Control.GetStartItemNum()-$SearchResults.Control.GetEndItemNum($SearchResults.Results.TotalResults) of <span data-basiccts-searchparam='n'>$SearchResults.Results.TotalResults</span>
        </div>
        #DrawResultsV2($SearchResults)
      #else
        #DrawNoResultsTextV2()
      #end
    #else
      #DrawNoResultsTextV2()
    #end
  </div>

</div>
